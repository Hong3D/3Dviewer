<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>3D Gallery</title>
<link rel="icon" href="data:," />
<style>
  :root{ --bg:#0f1115; --card:#171a21; --text:#e8ecf1; --muted:#9aa4b2; --accent:#61a8ff }
  *{ box-sizing:border-box }
  html,body{ margin:0; height:100%; background:var(--bg); color:var(--text); font-family:system-ui,Segoe UI,Roboto,Apple SD Gothic Neo,arial }
  header{ padding:16px 20px; display:flex; align-items:center; gap:12px; border-bottom:1px solid #222 }
  header h1{ margin:0; font-size:18px; font-weight:600 }
  #search{ flex:1; max-width:520px; padding:10px 12px; border-radius:10px; border:1px solid #2a2f3a; background:#10131a; color:var(--text) }
  main{ padding:20px; }
  .grid{ display:grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap:16px; }
  .card{ background:var(--card); border:1px solid #202633; border-radius:14px; overflow:hidden; box-shadow:0 2px 10px rgba(0,0,0,.25); transition:transform .12s ease }
  .card:hover{ transform:translateY(-2px) }
  .thumb{ width:100%; aspect-ratio:16/9; object-fit:cover; background:#0b0d12 }
  .body{ padding:12px 14px; display:flex; align-items:center; justify-content:space-between; gap:10px }
  .title{ font-size:15px; font-weight:600; line-height:1.3; overflow:hidden; text-overflow:ellipsis; white-space:nowrap }
  .btn{ padding:8px 10px; border:0; border-radius:9px; background:#22324a; color:#cfe3ff; cursor:pointer }
  .btn:hover{ background:#2a3a58 }
  .meta{ font-size:12px; color:var(--muted) }
  .empty{ opacity:.7; padding:40px; text-align:center }
  /* modal */
  #modal{ display:none; position:fixed; inset:0; background:#000a; z-index:9999; align-items:center; justify-content:center }
  #modal .wrap{ width:min(90vw,1200px); height:min(80vh,800px); background:#0b0d12; border-radius:12px; overflow:hidden; position:relative }
  #closeModal{ position:absolute; top:8px; right:8px; z-index:2; padding:6px 10px; border:0; border-radius:8px; background:#222; color:#fff; cursor:pointer }
  #preview{ width:100%; height:100%; border:0 }
</style>
</head>
<body>
  <header>
    <h1>3D Gallery</h1>
    <input id="search" placeholder="검색: 제목/태그" />
  </header>
  <main>
    <div id="grid" class="grid"></div>
    <div id="empty" class="empty" style="display:none">결과가 없습니다.</div>
  </main>

  <!-- preview modal -->
  <div id="modal">
    <div class="wrap">
      <button id="closeModal">Close</button>
      <iframe id="preview" src="about:blank"></iframe>
    </div>
  </div>

<script type="module">
const GRID = document.getElementById('grid');
const EMPTY = document.getElementById('empty');
const SEARCH = document.getElementById('search');
const MODAL = document.getElementById('modal');
const PREVIEW = document.getElementById('preview');
document.getElementById('closeModal').onclick = closeModal;
MODAL.addEventListener('click', e=>{ if (e.target.id==='modal') closeModal(); });

const PLACEHOLDER = 'https://dummyimage.com/1280x720/0d1117/8892a6&text=No+Thumbnail';
const MANIFEST_URL = './catalog/manifest.json';

let items = [], filtered = [];

function closeModal(){ MODAL.style.display='none'; PREVIEW.src='about:blank'; }

function makeCard(it){
  const card = document.createElement('div'); card.className='card';
  const img = document.createElement('img'); img.className='thumb'; img.loading='lazy';
  img.src = it.thumb || PLACEHOLDER; img.alt = it.title || 'model'; img.onerror = ()=>{ img.src = PLACEHOLDER; };
  const body = document.createElement('div'); body.className='body';
  const title = document.createElement('div'); title.className='title'; title.textContent = it.title || '(no title)';
  const right = document.createElement('div'); right.style.display='flex'; right.style.gap='8px'; right.style.alignItems='center';
  const preview = document.createElement('button'); preview.className='btn'; preview.textContent='Preview';
  preview.onclick = ()=>{ const url = it.open.includes('?') ? it.open + '&embed=1' : it.open + '?embed=1'; PREVIEW.src = url; MODAL.style.display = 'flex'; };
  const open = document.createElement('button'); open.className='btn'; open.textContent='Open';
  open.onclick = ()=>{ if (it.open) location.href = it.open; };
  const meta = document.createElement('div'); meta.className='meta';
  meta.textContent = (it.meta?.tags?.join(', ') || '') + (it.meta?.date ? (it.meta?.tags?.length? ' · ':'') + it.meta.date : '');
  right.append(preview, open);
  body.append(title, right);
  card.append(img, body, meta);
  return card;
}

function render(list){
  GRID.innerHTML = '';
  if (!list.length){ EMPTY.style.display='block'; return; }
  EMPTY.style.display='none';
  for (const it of list){ GRID.append(makeCard(it)); }
}

function applyFilter(q){
  q = (q||'').trim().toLowerCase();
  if (!q){ filtered = items.slice(); render(filtered); return; }
  filtered = items.filter(it=>{
    const hay = (it.title||'')+' '+(it.meta?.tags?.join(' ')||'');
    return hay.toLowerCase().includes(q);
  });
  render(filtered);
}

async function boot(){
  try{
    const res = await fetch(MANIFEST_URL);
    items = await res.json();
    filtered = items.slice();
    render(filtered);
  }catch(e){
    console.error(e);
    GRID.innerHTML = '<div class="empty">manifest.json을 불러오지 못했습니다.</div>';
  }
}
SEARCH.addEventListener('input', e=>applyFilter(e.target.value));
boot();
</script>
</body>
</html>
